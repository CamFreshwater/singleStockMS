---
header-includes:
  - \usepackage{caption}
output:
  word_document:
    fig_caption: yes
    reference_docx: templates/blankMS.docx
  # bookdown::pdf_document2:
  #   fig_caption: yes
  #   latex_engine: pdflatex
    # includes:
    #   in_header: preamble-latex.tex
csl: csl/ecology.csl
link-citations: no
bibliography: bib/ms_singleStock.bib
---

```{r setup, echo=FALSE, cache=FALSE, message=FALSE, results='hide', warning=FALSE}
# adjust as desired:
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = if (knitr:::is_latex_output()) "knitr-figs-pdf/" else "knitr-figs-docx/",
  cache.path = if (knitr:::is_latex_output()) "knitr-cache-tex/" else "knitr-cache-docx/",
  fig.asp = 0.618,
  fig.width = 9,
  out.width = "6in",
  echo = FALSE,
#  autodep = TRUE,
#  cache = TRUE,
  cache.comments = FALSE,
  dev = if (knitr:::is_latex_output()) "png" else "png",
  dpi = 180,
  fig.align = "center",
  fig.pos = "htb"
)
options(kableExtra.latex.load_packages = FALSE)
```

```{r load-libraries, cache=FALSE}
# add other packages here:
library(csasdown)
library(here)
library(tidyverse)
library(samSim)
library(knitr)
library(kableExtra)
```


## Larkin model

Cyclic salmon stocks are typically modeled using an adaptation of the Ricker model, the Larkin model, featuring delayed density-dependence parameters [@Larkin1971]:

Equation S1  $$log(\frac{R_{i,y}}{S_{i,y}}) = \alpha_i - \beta_iS_{i,y} - \beta_{1,i}S_{i,y-1} - \beta_{2,i}S_{i,y-2} - \beta_{3,i}S_{i,y-3} + w_{i,y}$$

where $i$ represents a stock, $y$ is a given brood year, $R$ the number of recruits, and $S$ the number of spawners. The parameter $\alpha$ represents the number of recruits produced per spawner at low abundance, while $\beta_{x}$ is the density-dependent parameter at time lag $x$. Stochastic recruitment deviations, $w_{i,y}$, are normally distributed with mean zero and variance $\sigma^2$. Fraser River sockeye salmon stocks modeled with a Larkin relationship contain one dominant and three off-cycle lines.

## Recursive Bayes stock-recruit model

_Add based on info from Ann-Marie_

## Harvest control rules

As described in the main text, the simulation model generated target harvest rates (for both fisheries combined) using a generic, abundance-based harvest control rule (HCR) proposed under Fisheries and Oceans Canada's Precautionary Approach Framework [@DFO2017b]. Specifically a minimal exploitation rate (10%) approximating incidental harvest was applied when MU-level abundance was less than 40% of the spawner abundance that would lead to maximumum sustainable yield ($0.4{S}_{MSY}$). When abundance was greater than 80% of that spawner abundance ($0.8{S}_{MSY}$), the exploitation rate at maximum sustainable yield (approximated by ${u}_{MSY}$; Fig. S1) was applied. When return abundance was between these two reference points, the target exploitation rate was a linear function of abundance (Fig. S1). All reference points were derived from aggregate benchmarks calculated after summing spawner and return abundances across stocks.

```{r genHCR, warnings=FALSE, messages=FALSE, fig.cap="Figure S1. Generic, abundance-based harvest control rule used to calculate target exploitation rates. Dashed vertical lines represent lower (red) and upper (green) fishery reference points equivalent to $0.4{S}_{MSY}$ and $0.8{S}_{MSY}$, respectively. The maximum exploitation rate is equal to ${u}_{MSY}$."}
cuPar <- read.csv(here::here("data/summOnlyCUPars.csv"), stringsAsFactors = F)

uMsy <- cuPar$uMSY[1]
lowFRP <- cuPar$lowFRP[1]
highFRP <- cuPar$highFRP[1]

ret = seq(0, 2, length.out = 999)
esc = rep(NA, length.out = 999)
hr = rep(NA, length.out = 999)
for (i in 1:length(ret)) {
  if (ret[i] < lowFRP) {
    hr[i] <- 0.1
  }
  if (ret[i] > lowFRP & ret[i] < highFRP) {
    hr[i] <- max(0.1, 
                 uMsy * ((ret[i] - lowFRP) / (highFRP - lowFRP))
                 )
  }
  if (ret[i] > highFRP) {
    hr[i] <- uMsy
  }
  esc[i] <- ret[i] - (ret[i] * hr[i])
}

plot(hr ~ ret, xlim=c(0, 2), ylim=c(0, 1), ylab = "", xlab = "", axes = F, 
     type ="l", lwd = 2)
axis(1, las = 1)
axis(2, las = 1)
mtext("Total Exploitation Rate", 2, line = 2.5)
mtext("Return Abundance (Millions)", 1, line = 2)
abline(v = lowFRP, col = "red", lty = 2, lwd = 2)
abline(v = highFRP, col = "darkgreen", lty = 2, lwd = 2)
```

We also evaluated the impact of an alternative HCR, a total allowable mortality (TAM) rule, intended to approximate the management framework currently used for Fraser River sockeye salmon. As with the reference HCR, the TAM rule specifies annual target harvest rates based return abundance relative to two fishery reference points. Unlike the generic HCR, however, the TAM rule reference points differ among cycle lines, are derived using expert knowledge, and the maximum target harvest rates are lower (Table S1).

```{r frpTable, results="asis"}
frpTable <- read.csv(here::here("data", "msTables", "frpTable.csv"))

csas_table(frpTable,
  caption = "Table S1. Fishery reference points (FRP; in millions of fish) and maximum exploitation rates (ER) for the generic harvest control rule utilized in the main text and the total allowable mortality rule.",
  font_size = 20,
  col_names = c("Harvest Control Rule", "Cycle", "Low FRP", "High FRP", "Maximum ER")
)
```

The TAM rule also differs from the generic HCR due to two additional adjustments. First, harvest rates are typically lowered due to anticipated en-route mortality. We simulated this process by applying an en-route mortality adjustment, _pMA_, that acts as a scalar on escapement goals (i.e. a _pMA_ equal to 0 is no adjustment, equal to 1 is a 100% increase in the escapement goal). We parameterized this model component by setting the _pMA_ equal to the median _pMA_ observed for the Summer Run MU since 2000. Harvest rates are also adjusted annually to reduce incidental harvest of co-migrating MUs that are at low abundance. However, we excluded this adjustment because we only modeled one MU (Summer Run stocks).

_Literature Cited_
